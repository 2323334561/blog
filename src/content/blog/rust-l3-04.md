---
title: ownership 所有权
pubDatetime: 2024-09-30T10:30:00+08:00
author: shushunie
slug: rust-l3-4
description: ""
---

# 手动管理

代表语言：C/C++

特点：

- 程序员通过 malloc 和 free （C）或 new 和 delete （C++）手动分配和释放内存

- 没有内置的垃圾回收机制

优点：

- 高效且灵活，适用于对性能要求极高的系统级编程

缺点：

- 容易出现内存泄漏、悬垂指针和缓冲区溢出等问题，需要非常小心的内存管理

# 垃圾回收

代表语言：JavaScript

特点

- 浏览器和 Node.js 环境中均使用垃圾回收器（如V8引擎的垃圾回收器）

- 采用标记-清除（Mark-and-Sweep）、标记-压缩（Mark-and-Compact）分代回收等算法

优点：

- 自动内存管理，适合快速开发和运行在多平台上的应用

缺点：

- 垃圾回收机制在某些情况下可能导致性能问题，如UI线程停顿

# 所有权系统

代表语言：Rust

特点：

- Rust使用所有权系统进行内存管理，编译器在编译时通过静态分析来确保内存安全

- 通过借用（引用）机制来共享数据，同时保证数据竞争和悬垂指针的安全

- 每个值都有一个所有者，在任何时候只能有一个有效的所有者

优点：

- 在编译时保证内存安全，没有运行时开销

- 避免了数据竞争和悬垂指针

缺点：

- 需要程序员理解和遵循所有权和借用规则，学习曲线较陡

### 所有权规则

1. 每一个值都有一个所有者（owner）

2. 在任一时刻，值只能有一个所有者

3. 当所有者离开作用域（scope），值会被丟弃（drop）

### 所有权转移

当复杂类型变量相互赋值时，其他语言的效果是

```rust
{
    let s1 = String::from("hello"); // hello 的所有者是 s1，s1 指向保存 hello 的堆内存地址
    let _s2 = s1; // hello 的所有权转移给 s2，s2 指向保存 hello 的堆内存地址，s1 指向空
    // 块结束，自动释放 hello 使用的堆内存
}
```
