---
title: 数组与切片
pubDatetime: 2024-09-30T10:30:00+08:00
author: shushunie
slug: rust-l3-6
description: ""
---

# 数组

为分配一段连续的相同数据类型的内存块

### 类型

`[T; N]`表示 N 个值的数组，每个值的类型为T。如果不写类型声明，会自动推导

数组的大小是在编译期就已确定的常量，并且是类型的一部分，不能追加新元素或缩小数组。如果一定要删除，需要将数组中元素值设置为特定值来表示它已经被删除

### 语法

```rust
// 不可变数组
let arr1 = [1, 2, 3];

// 可变数组
let mut arr2 = [1, 2, 3];

// 多个相同元素
let arr3 = [12; 3];
```

### 常用方法

- `len()`：取 slice 元素个数

  `v.len()` 会给出 v 中的元素数，而 `v[i]` 引用的是v的第 i 个元素。V的第一个元素是 v[0]，最后一个元素是 `v[v.len()- 1]`。Rust 总是会检查 i 是否在这个范围内，如果没在此表达式会出现 panic。v 的长度可能为 0，在这种情况下，任何对其进行索引的尝试都会出现 panic。i 的类型必须是 usize，不能使用任何其他整型作为索引

- `is_empty()`：判断 slice 是否为空

- `contains()`：判断是否包含某个元素

- `repeat()`：重复 slice 指定次数

- `reverse()`：反转 slice

- `join()`：将各元素压平（flatten）并通过指定的分隔符连接起来

- `starts_with()`：判断 slice 是否以某个 slice 开头

### 值传递与引用传递

值传递：数组直接作为函数参数使用时，会执行拷贝操作。函数内操作的是拷贝出的新变量，不会影响原数组

```rust
fn func1(mut arr: [i32; 3]) {
    arr[0] = 3;
}
```

引用传递：数组的引用作为函数参数时，需要传入数组的引用。函数内部修改数组会影响原数组

```rust
fn func2(arr: &mut [i32; 3]) {
    arr[0] = 4;
}
```

# 切片

Slice 类型通常翻译为切片，它表示从某个包含多个元素的容器中取得局部数据，这个过程称为切片操作

不同语言对切片的支持有所不同，比如有些语言只允许取得连续的局部元素，而有些语言可以取得离散元素，甚至有些语言可以对 hash 结构进行切片操作。Rust 中的切片操作只允许获取一段连续的局部数据， 切片操作获取到的数据称为切片数据

Rust常见的数据类型中，有三种类型已支持Slice操作：String 类型、Array 类型和 Vec 类型

### 类型

类型` &[T]`和 `&mut [T]`称为T的共享切片和 T 的可变切片，它们是对一系列元素的引用，这些元素是某个其他值（比如数组或向量）的一部分。可以将切片视为指向其第一个元素的指针，以及从该点开始允许访问的元素数量的计数。可变切片 &mut[T] 允许读取元素和修改元素，但不能共享；共享切片 &[T] 允许在多个读取者之间共享访问权限，但不允许修改元素

### 语法

```rust
// 共享切片
let _s1 = &arr2[1..2];

// 可变切片
let _s2 = &mut arr2[1..2];
```
